// lib/i18n.js
import { createContext, useContext, useEffect, useMemo, useState } from 'react';

const I18nContext = createContext();

const SUPPORTED = [
  { code: 'de', label: 'Deutsch' },
  { code: 'en', label: 'English' },
  { code: 'fr', label: 'Français' },
  { code: 'es', label: 'Español' },
  { code: 'it', label: 'Italiano' },
  { code: 'pl', label: 'Polski' },
  { code: 'zh', label: '中文' },
  { code: 'ja', label: '日本語' },
];

const fallback = 'en';

const dict = {
  en: {
    // nav
    nav_pool: 'Pool',
    nav_records: 'Records',
    nav_results: 'Results',
    nav_about: 'About',
    // common
    loading: 'Loading...',
    // page: records
    world_records: 'World Records',
    filter_scope_all: 'All categories',
    filter_scope_open: 'Open only',
    filter_scope_masters: 'Masters',
    filter_scope_youth: 'Youth',
    filter_gender_all: 'All genders',
    filter_gender_m: 'Men',
    filter_gender_w: 'Women',
    filter_event_all: 'Individual & Relays',
    filter_event_individual: 'Individual',
    filter_event_relay: 'Relay',
    filter_nation: 'Nation (optional)',
    filter_disc: 'Discipline search (e.g. MANIKIN)',
    col_discipline: 'Discipline',
    col_gender: 'G',
    col_time: 'Time',
    col_athlete: 'Athlete / Team',
    col_nation: 'Nation',
    col_meet: 'Meet',
    col_date: 'Date',
    table_note: 'Display is condensed for readability. Long text will be trimmed.',
  },
  de: {
    nav_pool: 'Pool',
    nav_records: 'Rekorde',
    nav_results: 'Ergebnisse',
    nav_about: 'Über',
    loading: 'Lade...',
    world_records: 'World Records',
    filter_scope_all: 'Alle Klassen',
    filter_scope_open: 'Nur Open',
    filter_scope_masters: 'Masters',
    filter_scope_youth: 'Youth',
    filter_gender_all: 'Alle Geschlechter',
    filter_gender_m: 'Männer',
    filter_gender_w: 'Frauen',
    filter_event_all: 'Einzel & Staffeln',
    filter_event_individual: 'Einzel',
    filter_event_relay: 'Staffel',
    filter_nation: 'Nation (optional)',
    filter_disc: 'Disziplin-Suche (z. B. MANIKIN)',
    col_discipline: 'Disziplin',
    col_gender: 'G',
    col_time: 'Zeit',
    col_athlete: 'Athlet / Team',
    col_nation: 'Nation',
    col_meet: 'Wettkampf',
    col_date: 'Datum',
    table_note: 'Darstellung ist komprimiert. Lange Texte werden gekürzt.',
  },
  fr: {
    nav_pool: 'Piscine',
    nav_records: 'Records',
    nav_results: 'Résultats',
    nav_about: 'À propos',
    loading: 'Chargement…',
    world_records: 'Records du monde',
    filter_scope_all: 'Toutes catégories',
    filter_scope_open: 'Open',
    filter_scope_masters: 'Masters',
    filter_scope_youth: 'Jeunes',
    filter_gender_all: 'Tous genres',
    filter_gender_m: 'Hommes',
    filter_gender_w: 'Femmes',
    filter_event_all: 'Individuel & Relais',
    filter_event_individual: 'Individuel',
    filter_event_relay: 'Relais',
    filter_nation: 'Nation (optionnel)',
    filter_disc: 'Recherche discipline (ex. MANIKIN)',
    col_discipline: 'Discipline',
    col_gender: 'G',
    col_time: 'Temps',
    col_athlete: 'Athlète / Équipe',
    col_nation: 'Nation',
    col_meet: 'Meeting',
    col_date: 'Date',
    table_note: 'Affichage compact. Les textes longs sont tronqués.',
  },
  es: {
    nav_pool: 'Piscina',
    nav_records: 'Récords',
    nav_results: 'Resultados',
    nav_about: 'Acerca de',
    loading: 'Cargando…',
    world_records: 'Récords mundiales',
    filter_scope_all: 'Todas las categorías',
    filter_scope_open: 'Open',
    filter_scope_masters: 'Masters',
    filter_scope_youth: 'Juvenil',
    filter_gender_all: 'Todos los géneros',
    filter_gender_m: 'Hombres',
    filter_gender_w: 'Mujeres',
    filter_event_all: 'Individual y relevos',
    filter_event_individual: 'Individual',
    filter_event_relay: 'Relevo',
    filter_nation: 'País (opcional)',
    filter_disc: 'Buscar disciplina (p. ej., MANIKIN)',
    col_discipline: 'Disciplina',
    col_gender: 'G',
    col_time: 'Tiempo',
    col_athlete: 'Atleta / Equipo',
    col_nation: 'País',
    col_meet: 'Competición',
    col_date: 'Fecha',
    table_note: 'Vista compacta. El texto largo se recorta.',
  },
  it: {
    nav_pool: 'Piscina',
    nav_records: 'Record',
    nav_results: 'Risultati',
    nav_about: 'Info',
    loading: 'Caricamento…',
    world_records: 'Record mondiali',
    filter_scope_all: 'Tutte le categorie',
    filter_scope_open: 'Open',
    filter_scope_masters: 'Masters',
    filter_scope_youth: 'Youth',
    filter_gender_all: 'Tutti i generi',
    filter_gender_m: 'Uomini',
    filter_gender_w: 'Donne',
    filter_event_all: 'Individuale e staffette',
    filter_event_individual: 'Individuale',
    filter_event_relay: 'Staffetta',
    filter_nation: 'Nazione (opzionale)',
    filter_disc: 'Cerca disciplina (es. MANIKIN)',
    col_discipline: 'Disciplina',
    col_gender: 'G',
    col_time: 'Tempo',
    col_athlete: 'Atleta / Team',
    col_nation: 'Nazione',
    col_meet: 'Meeting',
    col_date: 'Data',
    table_note: 'Vista compatta. Testi lunghi sono troncati.',
  },
  pl: {
    nav_pool: 'Basen',
    nav_records: 'Rekordy',
    nav_results: 'Wyniki',
    nav_about: 'O nas',
    loading: 'Wczytywanie…',
    world_records: 'Rekordy świata',
    filter_scope_all: 'Wszystkie kategorie',
    filter_scope_open: 'Open',
    filter_scope_masters: 'Masters',
    filter_scope_youth: 'Młodzież',
    filter_gender_all: 'Wszystkie płcie',
    filter_gender_m: 'Mężczyźni',
    filter_gender_w: 'Kobiety',
    filter_event_all: 'Indywidualne i sztafety',
    filter_event_individual: 'Indywidualne',
    filter_event_relay: 'Sztafeta',
    filter_nation: 'Kraj (opcjonalnie)',
    filter_disc: 'Szukaj dyscypliny (np. MANIKIN)',
    col_discipline: 'Dyscyplina',
    col_gender: 'P',
    col_time: 'Czas',
    col_athlete: 'Zawodnik / Zespół',
    col_nation: 'Kraj',
    col_meet: 'Zawody',
    col_date: 'Data',
    table_note: 'Widok zwarty. Długie teksty są skracane.',
  },
  zh: {
    nav_pool: '泳池',
    nav_records: '纪录',
    nav_results: '成绩',
    nav_about: '关于',
    loading: '加载中…',
    world_records: '世界纪录',
    filter_scope_all: '全部分类',
    filter_scope_open: '公开组',
    filter_scope_masters: '大师组',
    filter_scope_youth: '青年组',
    filter_gender_all: '所有性别',
    filter_gender_m: '男子',
    filter_gender_w: '女子',
    filter_event_all: '个人与接力',
    filter_event_individual: '个人',
    filter_event_relay: '接力',
    filter_nation: '国家（可选）',
    filter_disc: '项目搜索（如 MANIKIN）',
    col_discipline: '项目',
    col_gender: '性别',
    col_time: '成绩',
    col_athlete: '运动员/队伍',
    col_nation: '国家',
    col_meet: '赛事',
    col_date: '日期',
    table_note: '紧凑显示；长文本将被截断。',
  },
  ja: {
    nav_pool: 'プール',
    nav_records: '記録',
    nav_results: '結果',
    nav_about: '概要',
    loading: '読み込み中…',
    world_records: '世界記録',
    filter_scope_all: 'すべての区分',
    filter_scope_open: 'オープン',
    filter_scope_masters: 'マスターズ',
    filter_scope_youth: 'ユース',
    filter_gender_all: 'すべての性別',
    filter_gender_m: '男子',
    filter_gender_w: '女子',
    filter_event_all: '個人 & リレー',
    filter_event_individual: '個人',
    filter_event_relay: 'リレー',
    filter_nation: '国（任意）',
    filter_disc: '種目検索（例：MANIKIN）',
    col_discipline: '種目',
    col_gender: 'G',
    col_time: 'タイム',
    col_athlete: '選手 / チーム',
    col_nation: '国',
    col_meet: '大会',
    col_date: '日付',
    table_note: 'コンパクト表示。長文は省略されます。',
  },
};

export function I18nProvider({ children }) {
  const [lang, setLang] = useState(fallback);

  useEffect(() => {
    const saved = typeof window !== 'undefined' ? localStorage.getItem('lang') : null;
    if (saved && dict[saved]) setLang(saved);
  }, []);
  useEffect(() => {
    if (typeof window !== 'undefined') {
      localStorage.setItem('lang', lang);
      try { document.documentElement.lang = lang; } catch {}
    }
  }, [lang]);

  const t = useMemo(() => {
    const d = dict[lang] || dict[fallback];
    return (key) => d[key] ?? (dict[fallback][key] ?? key);
  }, [lang]);

  const value = useMemo(
    () => ({ lang, setLang, t, languages: SUPPORTED }),
    [lang, t]
  );

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  return useContext(I18nContext);
}
